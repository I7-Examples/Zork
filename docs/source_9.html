<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html>

	<head>
		<meta http-equiv="content-type" content="text/html;charset=utf-8">
		<meta name="generator" content="Adobe GoLive">
		<title>Zork - Source Text</title>
	</head>

	<body bgcolor="#ffffff">
		<table border="0" cellpadding="2"><tr><td align="left" valign="top"><font face="Trebuchet MS, Geneva, Arial, Helvetica, SunSans-Regular, sans-serif"></font></td><td align="left" valign="top">
					<h3><font color="#0000cc" face="Trebuchet MS, Geneva, Arial, Helvetica, SunSans-Regular, sans-serif">Zork</font></h3>
					<h3><font size="-1" face="Trebuchet MS, Geneva, Arial, Helvetica, SunSans-Regular, sans-serif">An interactive fiction by Dean Menezes (2023) - the Inform 7 source text</font></h3>
				</td></tr>
		<tr align="left" valign="top"><td align="left" valign="top"><font size="-1" face="Trebuchet MS, Geneva, Arial, Helvetica, SunSans-Regular, sans-serif"><a href="index.html">Home page</a><br><br><a href="source.html">Contents</a><br><a href="source_8.html">Previous</a><br><br><a href="source.txt">Complete text</a></font></td><td align="left" valign="top"><font face="Trebuchet MS, Geneva, Arial, Helvetica, SunSans-Regular, sans-serif"><b>Part 10 - The End Game</b>
<br>

<br>
To decide what indexed text is the encryption of (x - an indexed text):
<br>
let keyw be {5, 3, 15, 22, 24, 18, 13, 19};
<br>
let outw be an indexed text;
<br>
let uinws be 0;
<br>
let usum be 0;
<br>
let inw be a list of numbers;
<br>
let i be 1;
<br>
let j be 1;
<br>
change outw to &quot;<font color=#000080>[8 spaces]</font>&quot;;
<br>
let len be the number of characters in x;
<br>
while i is at most 8 begin;
<br>
  if j is greater than len, change j to 1;
<br>
  let a be character number j in x;
<br>
  if a matches the regular expression &quot;<font color=#000080>&lt;^A-Z&gt;</font>&quot;, change j to 1;
<br>
  let a be character number j in x;
<br>
  let b be the alphabet position of a;
<br>
  add b to inw;
<br>
  increase uinws by b;
<br>
  increase i by 1;
<br>
  increase j by 1;
<br>
end while;
<br>
change usum to (the remainder after dividing uinws by 8) + 56;
<br>
change i to 1;
<br>
while i is at most 8 begin;
<br>
  let c be entry i of inw;
<br>
  let b be entry i of keyw;
<br>
  change j to the twiddle of c and b and usum;
<br>
  change j to the remainder after dividing j by 32;
<br>
  if j is greater than 26, change j to the remainder after dividing j by 26;
<br>
  change a to character number j in the alphabet;
<br>
  replace character number i in outw with a;
<br>
  change usum to the remainder after dividing (usum + 1) by 32;
<br>
  increase i by 1;
<br>
end while;
<br>
decide on outw.
<br>

<br>
To decide what number is the twiddle of (a - a number) and (b - a number) and (c - a number):
<br>
  (- xor(xor({a},{b}),{c}) -).
<br>

<br>
To decide which number is the alphabet position of (n - an indexed text):
<br>
if n is &quot;<font color=#000080>A</font>&quot;, decide on 1;
<br>
if n is &quot;<font color=#000080>B</font>&quot;, decide on 2;
<br>
if n is &quot;<font color=#000080>C</font>&quot;, decide on 3;
<br>
if n is &quot;<font color=#000080>D</font>&quot;, decide on 4;
<br>
if n is &quot;<font color=#000080>E</font>&quot;, decide on 5;
<br>
if n is &quot;<font color=#000080>F</font>&quot;, decide on 6;
<br>
if n is &quot;<font color=#000080>G</font>&quot;, decide on 7;
<br>
if n is &quot;<font color=#000080>H</font>&quot;, decide on 8;
<br>
if n is &quot;<font color=#000080>I</font>&quot;, decide on 9;
<br>
if n is &quot;<font color=#000080>J</font>&quot;, decide on 10;
<br>
if n is &quot;<font color=#000080>K</font>&quot;, decide on 11;
<br>
if n is &quot;<font color=#000080>L</font>&quot;, decide on 12;
<br>
if n is &quot;<font color=#000080>M</font>&quot;, decide on 13;
<br>
if n is &quot;<font color=#000080>N</font>&quot;, decide on 14;
<br>
if n is &quot;<font color=#000080>O</font>&quot;, decide on 15;
<br>
if n is &quot;<font color=#000080>P</font>&quot;, decide on 16;
<br>
if n is &quot;<font color=#000080>Q</font>&quot;, decide on 17;
<br>
if n is &quot;<font color=#000080>R</font>&quot;, decide on 18;
<br>
if n is &quot;<font color=#000080>S</font>&quot;, decide on 19;
<br>
if n is &quot;<font color=#000080>T</font>&quot;, decide on 20;
<br>
if n is &quot;<font color=#000080>U</font>&quot;, decide on 21;
<br>
if n is &quot;<font color=#000080>V</font>&quot;, decide on 22;
<br>
if n is &quot;<font color=#000080>W</font>&quot;, decide on 23;
<br>
if n is &quot;<font color=#000080>X</font>&quot;, decide on 24;
<br>
if n is &quot;<font color=#000080>Y</font>&quot;, decide on 25;
<br>
if n is &quot;<font color=#000080>Z</font>&quot;, decide on 26.
<br>
The alphabet is an indexed text variable.  The alphabet is always &quot;<font color=#000080>ABCDEFGHIJKLMNOPQRSTVWXYZ</font>&quot;.
<br>
Instead of exiting when the player is in a river:
<br>
  say &quot;<font color=#000080>You realize, just in time, that disembarking here would probably be fatal.</font>&quot;
<br>
Incanting is an action applying to one topic.  Understand &quot;<font color=#000080>incant [text]</font>&quot; as incanting.
<br>
Check incanting:
<br>
if endgame flag is true, say &quot;<font color=#000080>[one of]Sorry, only one incantation to a customer.[or]Incantations are useless once you have gotten this far[at random]</font>&quot; instead.
<br>

<br>
Carry out incanting:
<br>
let i be the number of words in the topic understood;
<br>
  let a be word number one in the topic understood;
<br>
  change a to &quot;<font color=#000080>[a in upper case]</font>&quot;;
<br>
  let b be word number two in the topic understood;
<br>
  change b to &quot;<font color=#000080>[b in upper case]</font>&quot;;
<br>
if i is 1 begin;
<br>
  let b be character number 1 in a;
<br>
  if b matches the regular expression &quot;<font color=#000080>&lt;^A-Z&gt;</font>&quot;, say &quot;<font color=#000080>Sorry, your secret word must begin with a letter.</font>&quot; instead;
<br>
  say &quot;<font color=#000080>A hollow voice replies '[encryption of a]'</font>&quot;;
<br>
else if i is 2;
<br>
 let c be character number one in a;
<br>
  let d be character number one in b;
<br>
 if c matches the regular expression &quot;<font color=#000080>&lt;^A-Z&gt;</font>&quot;, say &quot;<font color=#000080>That spell has no obvious effect.</font>&quot; instead;
<br>
  if d matches the regular expression &quot;<font color=#000080>&lt;^A-Z&gt;</font>&quot;, say &quot;<font color=#000080>That spell has no obvious effect.</font>&quot;;
<br>
  let e be the encryption of a;
<br>
  let f be the encryption of b;
<br>
  if e is b, skip to the endgame instead;
<br>
  if f is a, skip to the endgame instead;
<br>
  say &quot;<font color=#000080>That spell has no obvious effect.</font>&quot;;
<br>
else;
<br>
  say &quot;<font color=#000080>That spell has no obvious effect.</font>&quot;;
<br>
end if.
<br>
To skip to the endgame:
<br>
say &quot;<font color=#000080>As the last syllable of your spell fades into silence, darkness
<br>
</font><font color=#000080>envelops you, and the earth shakes briefly.  Then all is quiet.</font>&quot;;
<br>
change the score to 621;
<br>
change endgame flag to true;
<br>
move the battery-powered brass lantern to the player;
<br>
move the sword to the player;
<br>
move the player to Top of Stairs.
<br>

<br>
Endgame flag is a truth state that varies.  Endgame flag is false.
<br>

<br>
Top of Stairs is a room.  The description of Top of Stairs is &quot;<font color=#000080>You are standing at the top of a flight of stairs that lead down to a passage below.  Dim light, as from torches, can be seen in the passage.  Behind you the stairs lead into untouched rock.</font>&quot;
<br>
After looking while in Top of Stairs for the first time: award 10 points.
<br>
Instead of going south from Top of Stairs:  say &quot;<font color=#000080>The wall is solid rock.</font>&quot;
<br>
North of Top of Stairs is Stone Room.  Down from Top of Stairs is Stone Room.
<br>
The description of Stone Room is &quot;<font color=#000080>You are standing near one end of a long, dimly lit hall.  At the south stone stairs ascend.  To the north the corridor is illuminated
<br>
</font><font color=#000080>by torches set high in the walls, out of reach.  On one wall is a red
<br>
</font><font color=#000080>button.</font>&quot; A thing called a redbutton is here.  Understand &quot;<font color=#000080>red</font>&quot; and &quot;<font color=#000080>button</font>&quot; and &quot;<font color=#000080>switch</font>&quot; as the red button. The redbutton is scenery.  The printed name of the redbutton is &quot;<font color=#000080>red button</font>&quot;.
<br>
The redbutton has a truth state called depressed. Depressed is false.
<br>
Beam stopped is a truth state that varies.  Beam stopped is false.
<br>
Mrint is a number that varies.  Mrint is -1.
<br>
Instead of pushing the redbutton:
<br>
  if the depressed of the button is true begin;
<br>
    say &quot;<font color=#000080>The button is already depressed.</font>&quot;;
<br>
  else;
<br>
    say &quot;<font color=#000080>The button becomes depressed.</font>&quot;;
<br>
    if beam stopped is false begin;
<br>
      say &quot;<font color=#000080>The button pops back out.</font>&quot;;
<br>
    else;
<br>
      change mrint to 7;
<br>
      change mirror open to true;
<br>
    end if;
<br>
 end if.
<br>
Every turn:
<br>
  decrease mrint by 1;
<br>
  if mrint is 0 begin;
<br>
    if the player can see the redbutton, say &quot;<font color=#000080>The button pops back to its original position.</font>&quot;;
<br>
   change mirror open to false;
<br>
   change the depressed of the button to false;
<br>
  end if.
<br>
North of Stone Room is a room called Small Room.  The description of Small Room is &quot;<font color=#000080>You are in a small room, with narrow passages exiting to the north
<br>
</font><font color=#000080>and south.  A narrow red beam of light crosses the room at the north
<br>
</font><font color=#000080>end, inches above the floor.[if beam stopped is true]The beam is stopped halfway across the room by a sword lying on the floor.[end if]</font>&quot;.
<br>
A red beam of light is in Small Room.  The red beam of light is scenery.
<br>
Instead of destroying the beam of light with something:
<br>
try dropping the second noun instead.
<br>
After dropping the sword when beam stopped is false and the player can see the beam of light:
<br>
  say &quot;<font color=#000080>The beam is now blocked by a sword lying on the floor.</font>&quot;;
<br>
  change beam stopped to true.
<br>
After taking the sword when beam stopped is true and the player can see the beam of light:
<br>
  change beam stopped to false.
<br>
Instead of taking the beam of light:
<br>
  say &quot;<font color=#000080>No doubt you have a bottle of moonbeams as well.</font>&quot;
<br>
Mirror open is a truth state that varies.
<br>

<br>
Include (- <font color=#404040>[ XOR a b; return (a | b) &amp; (~(a &amp; b)); </font>];  -).
<br>

<br>

<br>

<br>
</font>
					<p><font size="-1" face="Trebuchet MS, Geneva, Arial, Helvetica, SunSans-Regular, sans-serif"></font></p>
					<p></p>
				</td></tr></table>
	</body>

</html>
